# 控制与监听设备状态

> 在执行以下操作前，请确认手机端与眼镜端的蓝牙通道已建立并维持连接，否则接口可能返回失败或无回调。

## 1. 获取眼镜信息

`getGlassInfo()` 可读取眼镜端的设备与账号信息，通过 `GlassInfoResultCallback` 返回。

```kotlin
fun getGlassesInfo() {
    CxrApi.getInstance().getGlassInfo(object : GlassInfoResultCallback {
        override fun onGlassInfoResult(
            status: ValueUtil.CxrStatus?,
            glassesInfo: GlassInfo?
        ) {
            // status: RESPONSE_SUCCEED / RESPONSE_INVALID / RESPONSE_TIMEOUT
            // glassesInfo: 眼镜信息模型
        }
    })
}
```

## 2. 同步眼镜时间与时区

`setGlassTime()` 会将当前系统时间同步至眼镜，返回值为 `ValueUtil.CxrStatus`。

```kotlin
fun setTime(): ValueUtil.CxrStatus {
    return CxrApi.getInstance().setGlassTime()
}
```

## 3. 设置与监听眼镜亮度

亮度范围为 `0..15`。通过 `setGlassBrightness()` 进行设置，并可注册 `BrightnessUpdateListener` 监听眼镜侧主动调整。

```kotlin
private val brightnessListener = object : BrightnessUpdateListener {
    override fun onBrightnessUpdated(brightness: Int) {
        // brightness ∈ [0, 15]
    }
}

fun observeBrightness(enable: Boolean) {
    CxrApi.getInstance().setBrightnessUpdateListener(
        if (enable) brightnessListener else null
    )
}

fun setBrightness(brightness: Int): ValueUtil.CxrStatus? {
    return CxrApi.getInstance().setGlassBrightness(brightness)
}
```

## 4. 设置与监听眼镜音量

音量范围同样为 `0..15`。使用 `setGlassVolume()` 设置，并通过 `VolumeUpdateListener` 监听。

```kotlin
private val volumeListener = object : VolumeUpdateListener {
    override fun onVolumeUpdated(volume: Int) {
        // volume ∈ [0, 15]
    }
}

fun observeVolume(enable: Boolean) {
    CxrApi.getInstance().setVolumeUpdateListener(
        if (enable) volumeListener else null
    )
}

fun setVolume(volume: Int): ValueUtil.CxrStatus? {
    return CxrApi.getInstance().setGlassVolume(volume)
}
```

## 5. 设置音效模式

`setSoundEffect(mode)` 支持以下取值：
- `AdiMode0`：洪亮（Loud）
- `AdiMode1`：韵律（Rhythm）
- `AdiMode2`：播客（Podcast）

```kotlin
fun setSoundEffect(value: String): ValueUtil.CxrStatus? {
    return CxrApi.getInstance().setSoundEffect(value)
}
```

## 6. 监听电量变化

通过 `BatteryLevelUpdateListener` 可实时获知电量百分比与充电状态。

```kotlin
CxrApi.getInstance().setBatteryLevelUpdateListener(
    object : BatteryLevelUpdateListener {
        override fun onBatteryLevelUpdated(level: Int, charging: Boolean) {
            // level ∈ [0, 100]，charging 表示是否正在充电
        }
    }
)
```

## 7. 设置自动熄屏时间

```kotlin
fun setScreenOffTimeout(seconds: Long): ValueUtil.CxrStatus? {
    return CxrApi.getInstance().setScreenOffTimeout(seconds)
}
```

## 8. 设置自动关机时间

```kotlin
fun setPowerOffTimeout(minutes: Int): ValueUtil.CxrStatus? {
    return CxrApi.getInstance().setPowerOffTimeout(minutes)
}
```

## 9. 通知眼镜重启

```kotlin
fun rebootGlasses(): ValueUtil.CxrStatus {
    return CxrApi.getInstance().notifyGlassReboot()
}
```

## 10. 通知眼镜关机

```kotlin
fun shutdownGlasses(): ValueUtil.CxrStatus {
    return CxrApi.getInstance().notifyGlassShutdown()
}
```

---

### 开发建议

- **状态前置校验**：在调用所有接口前，请先确认 `CxrApi.getInstance().isBluetoothConnected` 为 `true`。
- **监听解绑**：在界面销毁或不再需要时，及时移除亮度、音量、电量等监听器，避免内存泄漏。
- **错误处理**：`ValueUtil.CxrStatus` 中的 `REQUEST_WAITING` 表示眼镜端正在处理，请勿立即重复调用，可结合回调或延迟重试。
- **日志规范**：保持日志内容为英文，并遵循项目统一的日志等级与标签规则。

